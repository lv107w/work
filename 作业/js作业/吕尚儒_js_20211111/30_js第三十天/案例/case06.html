<!--
 * @Author: your name
 * @Date: 2020-08-15 16:10:27
 * @LastEditTime: 2020-08-15 22:44:40
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \案例\demo7.html
-->
<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <style>
    * {
      user-select: none;
      margin: 0;
      padding: 0;
    }

    .wrap {
      overflow: hidden;
      position: relative;
      width: 300px;
      height: 500px;
      margin: 100px auto;
      box-shadow: 0 0 8px #222;
    }

    .content {
      position: absolute;
      top: 0;
      left: 0;
      padding: 5px 20px 5px 5px;
      color: #333;
      line-height: 22px;
      font-size: 14px;
      text-align: justify;
    }

    .scroll {
      position: absolute;
      top: 0;
      right: 0;
      width: 15px;
      height: 100%;
      background-color: #ccc;
    }

    .bar {
      position: absolute;
      width: 15px;
      height: 80px;
      background-color: #444;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div class="wrap">
    <div class="content">
      浔阳江头夜送客，枫叶荻花秋瑟瑟。主人下马客在船，举酒欲饮无管弦。醉不成欢惨将别，别时茫茫江浸月。忽闻水上琵琶声，主人忘归客不发。寻声暗问弹者谁，琵琶声停欲语迟。移船相近邀相见，添酒回灯重开宴。千呼万唤始出来，犹抱琵琶半遮面。转轴拨弦三两声，未成曲调先有情。弦弦掩抑声声思，似诉平生不得志。低眉信手续续弹，说尽心中无限事。轻拢慢捻抹复挑，初为《霓裳》后《六幺》。大弦嘈嘈如急雨，小弦切切如私语。嘈嘈切切错杂弹，大珠小珠落玉盘。间关莺语花底滑，幽咽泉流冰下难。冰泉冷涩弦凝绝，凝绝不通声暂歇。别有幽愁暗恨生，此时无声胜有声。银瓶乍破水浆迸，铁骑突出刀枪鸣。曲终收拨当心画，四弦一声如裂帛。东船西舫悄无言，唯见江心秋月白。沉吟放拨插弦中，整顿衣裳起敛容。自言本是京城女，家在虾蟆陵下住。十三学得琵琶成，名属教坊第一部。曲罢曾教善才服，妆成每被秋娘妒。五陵年少争缠头，一曲红绡不知数。钿头银篦击节碎，血色罗裙翻酒污。今年欢笑复明年，秋月春风等闲度。弟走从军阿姨死，暮去朝来颜色故。门前冷落鞍马稀，老大嫁作商人妇。商人重利轻别离，前月浮梁买茶去。去来江口守空船，绕船月明江水寒。夜深忽梦少年事，梦啼妆泪红阑干。我闻琵琶已叹息，又闻此语重唧唧。同是天涯沦落人，相逢何必曾相识！我从去年辞帝京，谪居卧病浔阳城。浔阳地僻无音乐，终岁不闻丝竹声。住近湓江地低湿，黄芦苦竹绕宅生。其间旦暮闻何物？杜鹃啼血猿哀鸣。春江花朝秋月夜，往往取酒还独倾。岂无山歌与村笛？呕哑嘲哳难为听。今夜闻君琵琶语，如听仙乐耳暂明。莫辞更坐弹一曲，为君翻作《琵琶行》。感我此言良久立，却坐促弦弦转急。凄凄不似向前声，满座重闻皆掩泣。座中泣下谁最多？江州司马青衫湿。
      浔阳江头夜送客，枫叶荻花秋瑟瑟。主人下马客在船，举酒欲饮无管弦。醉不成欢惨将别，别时茫茫江浸月。忽闻水上琵琶声，主人忘归客不发。寻声暗问弹者谁，琵琶声停欲语迟。移船相近邀相见，添酒回灯重开宴。千呼万唤始出来，犹抱琵琶半遮面。转轴拨弦三两声，未成曲调先有情。弦弦掩抑声声思，似诉平生不得志。低眉信手续续弹，说尽心中无限事。轻拢慢捻抹复挑，初为《霓裳》后《六幺》。大弦嘈嘈如急雨，小弦切切如私语。嘈嘈切切错杂弹，大珠小珠落玉盘。间关莺语花底滑，幽咽泉流冰下难。冰泉冷涩弦凝绝，凝绝不通声暂歇。别有幽愁暗恨生，此时无声胜有声。银瓶乍破水浆迸，铁骑突出刀枪鸣。曲终收拨当心画，四弦一声如裂帛。东船西舫悄无言，唯见江心秋月白。沉吟放拨插弦中，整顿衣裳起敛容。自言本是京城女，家在虾蟆陵下住。十三学得琵琶成，名属教坊第一部。曲罢曾教善才服，妆成每被秋娘妒。五陵年少争缠头，一曲红绡不知数。钿头银篦击节碎，血色罗裙翻酒污。今年欢笑复明年，秋月春风等闲度。弟走从军阿姨死，暮去朝来颜色故。门前冷落鞍马稀，老大嫁作商人妇。商人重利轻别离，前月浮梁买茶去。去来江口守空船，绕船月明江水寒。夜深忽梦少年事，梦啼妆泪红阑干。我闻琵琶已叹息，又闻此语重唧唧。同是天涯沦落人，相逢何必曾相识！我从去年辞帝京，谪居卧病浔阳城。浔阳地僻无音乐，终岁不闻丝竹声。住近湓江地低湿，黄芦苦竹绕宅生。其间旦暮闻何物？杜鹃啼血猿哀鸣。春江花朝秋月夜，往往取酒还独倾。岂无山歌与村笛？呕哑嘲哳难为听。今夜闻君琵琶语，如听仙乐耳暂明。莫辞更坐弹一曲，为君翻作《琵琶行》。感我此言良久立，却坐促弦弦转急。凄凄不似向前声，满座重闻皆掩泣。座中泣下谁最多？江州司马青衫湿。
    </div>
    <div class="scroll">
      <div class="bar"></div>
    </div>
  </div>
  <script src="js/common.js"></script>
  <script>
    /*
      自定义滚动条组件

      1. 自定义滚动条的滚动
        0. 初始化滚动轴高度 滚动轴高度 需要按照实际内容高度比例设置

          窗口高度/内容高度 = 滚动轴高度/滚动条高度

          滚动轴高度 = 窗口高度/内容高度 * 滚动条高度

          窗口高度 = oWrap.offsetHeight

          内容高度 =  content.offsetHeight

          滚动条高度 = oScroll.offsetHeight

        1. 鼠标拖拽滚动轴在滚动条中移动 Y
      2. 自定义滚动条带动content 的滚动
      3. 鼠标滚轮事件控制滚动条滚动以及带动content滚动

    */

    var oWrap = $('.wrap');
    var oCon = $('.content');
    var oScroll = $('.scroll');
    var oBar = $('.bar');
    var ratio = 0;

    initScroll();
    //初始化函数
    function initScroll() {
      //初始化滚动轴高度  滚动轴高度 = 
      oBar.style.height = oWrap.offsetHeight / oCon.offsetHeight * oScroll.offsetHeight + 'px';
      ratio = (oCon.offsetHeight - oWrap.offsetHeight) / (oScroll.offsetHeight - oBar.offsetHeight);
    }

    var scrollEventMap = {
      isDown: false,
      start: {
        y: 0,
        top: 0
      },

      mousedown: function (e) {
        this.isDown = true;
        this.start.y = e.clientY;
        this.start.top = oBar.offsetTop;
      },
      mousemove: function (e) {
        if (!this.isDown) {
          return false;
        }
        var diffY = e.clientY - this.start.y;
        var _y = diffY + this.start.top;

        scrollBar(_y);
      },
      mouseup: function (e) {
        if (!this.isDown) {

          return false;
        }
        this.isDown = false;

      },
      mousewheel: function (e) {
        var _y = oBar.offsetTop;
        if (e.wheelDelta > 0) {
          _y -= 2;
        } else {
          _y += 2;
        }
        scrollBar(_y);
      }
    }

    oBar.addEventListener('mousedown', touchScroll, false);
    document.addEventListener('mousemove', touchScroll, false);
    document.addEventListener('mouseup', touchScroll, false);

    oWrap.addEventListener('mousewheel', touchScroll, false);


    function scrollBar(_y) {
      _y = Math.max(0, _y);
      _y = Math.min(_y, oScroll.offsetHeight - oBar.offsetHeight);
      oBar.style.top = _y + 'px';
      oCon.style.marginTop = -_y * ratio + 'px';
    }


    function touchScroll(e) {
      if (scrollEventMap[e.type] && typeof scrollEventMap[e.type] === 'function') {
        scrollEventMap[e.type](e);
      }
    }
  </script>
</body>

</html>